<div>
   <canvas id="depthChart"></canvas>
</div>

<div>
   <canvas id="playerNetChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const ctx = document.getElementById('depthChart');
const ctx2 = document.getElementById('playerNetChart');

const data = fetch("./numbers.json")
   .then((res) => {
      return res.json();
   })
data.then(data => SetupDepthChart(data))
//data.then(data => SetupPlayerNetChart(data))


function SetupDepthChart(data) {
   var labels = []

   Object.keys(data['buy-orders']).forEach( key => {
      if (!labels.includes(key))
         labels.push(key)
   })
   Object.keys(data['sell-orders']).forEach( key => {
      if (!labels.includes(key))
         labels.push(key)
   })

   labels.sort((a,b) => {return a - b})

   var buyDepthData = [data['buy-orders'][labels[0]] ?? 0]
   var sellDepthData = [data['sell-orders'][labels[0]] ?? 0]

   for (var i = 1; i < labels.length; i++) {
      buys = data['buy-orders'][labels[i]] ?? 0
      sells = (data['sell-orders'][labels[i]] ?? 0) + sellDepthData[i - 1]

      sellDepthData.push(sells)
      buyDepthData.push(buys)
   }

   buyDepthData = buyDepthData.reverse()

   for ( var i = 0; i < labels.length; i++) {
      if (sellDepthData[i] == 0)
         sellDepthData[i] = undefined
      if ( i > 0)
         buyDepthData[i] += buyDepthData[i - 1]
   }

   buyDepthData = buyDepthData.reverse()

   for (var i = 0; i < buyDepthData.length; i++)
      if (buyDepthData[i] == 0)
         buyDepthData[i] = undefined


   // SETUP
   new Chart(ctx, {
      type: 'line',
      data: {
         labels: labels,
         datasets: [
            {
               label: 'Selling Iron',
               fill: true,
               stepped: 'pre',
               data: sellDepthData,
            },
            {
               label: 'Buying Iron',
               fill: true,
               stepped: 'after',
               data: buyDepthData,
            }
         ]
      },
      options: {
         scales: {
            y: {
               beginAtZero: true,
               title: {
                  display: true,
                  text: "Exchanges left"
               }
            },
            x: {
               title: {
                  display: true,
                  text: data['exchange-input'] + ' Per ' + data['exchange-output'] + ' Price'
               }
            }
         },
         plugins: {
            title: {
               display: true, 
               text: 'Icenia ' + data['exchange-input'] + '/' + data['exchange-output'] + ' Market (' + data['date'] + ')'
            }
         }
      }
   });
}

function SetupPlayerNetChart(marketOrders) {
   console.log("Hello")
   
   const labels = [1, 2, 3, 4, 5, 6, 1 ,7 ];
   const data = {
      labels: labels,
      datasets: [
         {
            data: [65, 59, 80, 281, 56, 55, 40, -100],
            tension: 0.1
         }
      ]
   };
   const options = {
      scales: {
         y: {
            beginAtZero: true,
            title: {
               display: true,
               text: "Net Iron Change"
            }
         },
         x: {
            title: {
               display: true,
               text: 'Net Diamond Change'
            }
         }
      },
      plugins: {
         title: {
            display: true, 
            text: "Player Net Sale"
         }
      }
   }
   const config = {
      type: 'line',
      data: data,
      options: options
   };

   new Chart(ctx2, config)
}

</script>
